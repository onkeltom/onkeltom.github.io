const translations = {
  de: {
    'meta.title': 'Digitalagentur Onkel Tom',
    'meta.description': 'Digitale Strategien, die begeistern.',
    'nav.brand': 'Onkel Tom Digital',
    'nav.services': 'Leistungen',
    'nav.process': 'Ablauf',
    'nav.stats': 'Ergebnisse',
    'nav.testimonials': 'Stimmen',
    'nav.contact': 'Kontakt',
    'nav.toggle': 'EN',
    'nav.cta': 'Projekt starten',
    'hero.badge': 'Digitalagentur aus Berlin',
    'hero.title': 'Strategien, die morgen Bestand haben.',
    'hero.subtitle': 'Wir begleiten ambitionierte Marken vom ersten Funken bis zur performanten Kampagne.',
    'hero.primaryCta': 'Kostenloses Erstgespräch',
    'hero.secondaryCta': 'Video ansehen',
    'hero.stats.clientsLabel': 'Betreute Kunden',
    'hero.stats.clients': '48',
    'hero.stats.revenueLabel': 'Zusätzlicher Umsatz',
    'hero.stats.revenue': '1250000',
    'hero.stats.updatedLabel': 'Zuletzt aktualisiert',
    'hero.stats.updated': '2024-04-12',
    'hero.card.title': 'Insights in Echtzeit',
    'hero.card.copy': 'Live-Dashboards zeigen Kampagnenstatus, Benchmarks und Handlungsempfehlungen.',
    'hero.card.pointOne': 'Automatisierte Performance-Alerts',
    'hero.card.pointTwo': 'Segmentierte Personas in Sekunden',
    'hero.card.pointThree': 'Transparente Zielvereinbarungen',
    'services.heading': 'Wachstum über den gesamten Funnel.',
    'services.lead': 'Unsere spezialisierten Teams orchestrieren messbare Kampagnen, die den Unterschied machen.',
    'services.strategy.title': 'Strategische Roadmaps',
    'services.strategy.copy': 'Marktrecherche, Positionierung und Zielarchitekturen, die sich auszahlen.',
    'services.strategy.cta': 'So planen wir',
    'services.creative.title': 'Kreative Produktion',
    'services.creative.copy': 'Content-Serien, Motion Design und Landingpages, die konvertieren.',
    'services.creative.cta': 'Ergebnisse ansehen',
    'services.performance.title': 'Performance & Automation',
    'services.performance.copy': 'KI-gestützte Optimierung mit klaren KPIs und automatisierten Journeys.',
    'services.performance.cta': 'KPIs entdecken',
    'process.heading': 'Ein klarer Ablauf für mutige Teams.',
    'process.lead': 'Transparente Sprints, die schnell zu Ergebnissen führen.',
    'process.discovery.step': '1. Discovery',
    'process.discovery.title': 'Vision schärfen',
    'process.discovery.copy': 'Workshops, Datenanalyse und Zieldefinition mit allen Stakeholdern.',
    'process.prototype.step': '2. Prototyp',
    'process.prototype.title': 'Erlebnisse testen',
    'process.prototype.copy': 'Low-Fidelity-Prototypen validieren Ideen mit echten Nutzer:innen.',
    'process.launch.step': '3. Launch',
    'process.launch.title': 'Live gehen',
    'process.launch.copy': 'Kampagnen, Automationen und Tracking gehen kontrolliert live.',
    'process.optimize.step': '4. Scale',
    'process.optimize.title': 'Erfolge multiplizieren',
    'process.optimize.copy': 'Kontinuierliche Experimente liefern bessere Ergebnisse.',
    'stats.heading': 'Beweisbare Resultate für Ihre Stakeholder.',
    'stats.lead': 'Wir liefern belastbare Zahlen und transparente Lernkurven.',
    'stats.roi': '0.42',
    'stats.roiLabel': 'Ø-ROAS Steigerung nach 90 Tagen',
    'stats.launchTime': '6',
    'stats.launchTimeSuffix': 'Wochen',
    'stats.launchTimeLabel': 'Von Kick-off bis Kampagnenstart',
    'stats.nps': '72',
    'stats.npsLabel': 'Net Promoter Score unserer Partner:innen',
    'portfolio.heading': 'Kampagnen, die Gesprächsthema wurden.',
    'portfolio.lead': 'Ein Auszug unserer jüngsten Projekte, die Marken sichtbar gemacht haben.',
    'portfolio.cta': 'Weitere Cases anfragen',
    'portfolio.caseOne.title': 'Fintech: Conversion verdoppelt',
    'portfolio.caseOne.copyPrefix': 'Durch Funnel-Automationen stieg der Umsatz des Start-ups um',
    'portfolio.caseOne.impact': '0.36',
    'portfolio.caseOne.copySuffix': '.',
    'portfolio.caseTwo.title': 'Retail: Community aktiviert',
    'portfolio.caseTwo.copyPrefix': 'Social-Commerce-Kampagnen steigerten die Bestellungen um',
    'portfolio.caseTwo.impact': '0.54',
    'portfolio.caseTwo.copySuffix': '.',
    'portfolio.caseThree.title': 'Healthcare: Vertrauen gewonnen',
    'portfolio.caseThree.copyPrefix': 'Personalisierte Journeys erhöhten den NPS auf',
    'portfolio.caseThree.impact': '68',
    'portfolio.caseThree.copySuffix': '.',
    'testimonials.heading': 'Partnerschaften, die inspirieren.',
    'testimonials.lead': 'Feedback von Marken, die mit uns neue Standards setzen.',
    'testimonials.first.quote': '»Onkel Tom hat unser Team in Rekordzeit befähigt, datenbasierte Entscheidungen zu treffen.«',
    'testimonials.first.name': 'Elena Gruber',
    'testimonials.first.role': 'CMO, FlowPay',
    'testimonials.second.quote': '»Von der Idee bis zur Auswertung fühlten wir uns jederzeit abgeholt und informiert.«',
    'testimonials.second.name': 'Malik Aydin',
    'testimonials.second.role': 'Head of Growth, UrbanYard',
    'testimonials.third.quote': '»Selten haben wir eine so klare, empathische Kommunikation erlebt.«',
    'testimonials.third.name': 'Anja Keller',
    'testimonials.third.role': 'Direktorin Kommunikation, HealthFirst',
    'faq.heading': 'Antworten auf häufige Fragen.',
    'faq.lead': 'Transparenz ist uns wichtig. Hier finden Sie kompakte Antworten.',
    'faq.one.question': 'Wie schnell können wir starten?',
    'faq.one.answer': 'Nach dem Kick-off legen wir innerhalb von zehn Werktagen mit ersten Maßnahmen los.',
    'faq.two.question': 'Welche Branchen betreut ihr?',
    'faq.two.answer': 'Wir arbeiten mit Tech-, Retail-, Gesundheits- und Bildungsunternehmen zusammen.',
    'faq.three.question': 'Wie sehen eure Preise aus?',
    'faq.three.answer': 'Wir erstellen modulare Angebote ab 4.500 € monatlich – abgestimmt auf Ihre Ziele.',
    'contact.heading': 'Lassen Sie uns sprechen.',
    'contact.lead': 'Erzählen Sie uns von Ihren Wachstumszielen – wir melden uns innerhalb eines Werktags.',
    'contact.form.nameLabel': 'Name',
    'contact.form.namePlaceholder': 'Vor- und Nachname',
    'contact.form.emailLabel': 'E-Mail',
    'contact.form.emailPlaceholder': 'name@unternehmen.de',
    'contact.form.companyLabel': 'Unternehmen',
    'contact.form.companyPlaceholder': 'Firmenname',
    'contact.form.messageLabel': 'Projektbeschreibung',
    'contact.form.messagePlaceholder': 'Welche Ziele verfolgen Sie?',
    'contact.form.privacy': 'Ich stimme der Verarbeitung meiner Daten gemäß Datenschutzhinweisen zu.',
    'contact.form.submit': 'Nachricht senden',
    'contact.form.statusIdle': 'Wir antworten innerhalb eines Werktags.',
    'contact.form.statusSending': 'Wir prüfen Ihre Anfrage …',
    'contact.form.statusSuccess': 'Vielen Dank! Wir melden uns zeitnah.',
    'contact.form.statusError': 'Etwas ist schiefgelaufen. Bitte versuchen Sie es erneut.',
    'contact.form.toastSuccess': 'Anfrage erfolgreich übermittelt.',
    'contact.form.toastError': 'Nachricht konnte nicht gesendet werden. Bitte nutzen Sie das E-Mail-Fallback.',
    'contact.form.mailtoSubject': 'Projektanfrage über onkeltom.de',
    'footer.copyPrefix': '©',
    'footer.year': '2024-01-01',
    'footer.copySuffix': 'Onkel Tom Digitalagentur. Alle Rechte vorbehalten.',
    'footer.mail': 'hallo@onkeltom.de',
    'footer.privacy': 'Datenschutz',
  },
  en: {
    'meta.title': 'Onkel Tom Digital Agency',
    'meta.description': 'Digital strategies that delight.',
    'nav.brand': 'Onkel Tom Digital',
    'nav.services': 'Services',
    'nav.process': 'Process',
    'nav.stats': 'Results',
    'nav.testimonials': 'Voices',
    'nav.contact': 'Contact',
    'nav.toggle': 'DE',
    'nav.cta': 'Start a project',
    'hero.badge': 'Digital agency from Berlin',
    'hero.title': 'Strategies built to last.',
    'hero.subtitle': 'We guide ambitious brands from first spark to high-performing campaigns.',
    'hero.primaryCta': 'Book a free consultation',
    'hero.secondaryCta': 'Watch video',
    'hero.stats.clientsLabel': 'Clients guided',
    'hero.stats.clients': '48',
    'hero.stats.revenueLabel': 'Additional revenue',
    'hero.stats.revenue': '1250000',
    'hero.stats.updatedLabel': 'Last updated',
    'hero.stats.updated': '2024-04-12',
    'hero.card.title': 'Insights in real time',
    'hero.card.copy': 'Live dashboards highlight campaign status, benchmarks, and next steps.',
    'hero.card.pointOne': 'Automated performance alerts',
    'hero.card.pointTwo': 'Segmented personas in seconds',
    'hero.card.pointThree': 'Transparent goal agreements',
    'services.heading': 'Growth across the entire funnel.',
    'services.lead': 'Our specialist teams orchestrate measurable campaigns that make the difference.',
    'services.strategy.title': 'Strategic roadmaps',
    'services.strategy.copy': 'Market research, positioning, and goal architectures that pay off.',
    'services.strategy.cta': 'How we plan',
    'services.creative.title': 'Creative production',
    'services.creative.copy': 'Content series, motion design, and landing pages that convert.',
    'services.creative.cta': 'See results',
    'services.performance.title': 'Performance & automation',
    'services.performance.copy': 'AI-powered optimization with clear KPIs and automated journeys.',
    'services.performance.cta': 'Explore KPIs',
    'process.heading': 'A clear playbook for bold teams.',
    'process.lead': 'Transparent sprints that deliver quickly.',
    'process.discovery.step': '1. Discovery',
    'process.discovery.title': 'Sharpen the vision',
    'process.discovery.copy': 'Workshops, data analysis, and aligned goals with every stakeholder.',
    'process.prototype.step': '2. Prototype',
    'process.prototype.title': 'Test experiences',
    'process.prototype.copy': 'Low-fidelity prototypes validate ideas with real users.',
    'process.launch.step': '3. Launch',
    'process.launch.title': 'Go live',
    'process.launch.copy': 'Campaigns, automations, and tracking launch with control.',
    'process.optimize.step': '4. Scale',
    'process.optimize.title': 'Multiply wins',
    'process.optimize.copy': 'Continuous experiments keep improving results.',
    'stats.heading': 'Proof that convinces stakeholders.',
    'stats.lead': 'We deliver reliable metrics and transparent learning loops.',
    'stats.roi': '0.42',
    'stats.roiLabel': 'Avg. ROAS lift after 90 days',
    'stats.launchTime': '6',
    'stats.launchTimeSuffix': 'weeks',
    'stats.launchTimeLabel': 'From kick-off to campaign launch',
    'stats.nps': '72',
    'stats.npsLabel': 'Net Promoter Score from our partners',
    'portfolio.heading': 'Campaigns people talked about.',
    'portfolio.lead': 'A selection of recent projects that boosted brand visibility.',
    'portfolio.cta': 'Request more case studies',
    'portfolio.caseOne.title': 'Fintech: Conversion doubled',
    'portfolio.caseOne.copyPrefix': 'Automation lifted revenue by',
    'portfolio.caseOne.impact': '0.36',
    'portfolio.caseOne.copySuffix': '.',
    'portfolio.caseTwo.title': 'Retail: Community activated',
    'portfolio.caseTwo.copyPrefix': 'Social commerce increased orders by',
    'portfolio.caseTwo.impact': '0.54',
    'portfolio.caseTwo.copySuffix': '.',
    'portfolio.caseThree.title': 'Healthcare: Trust regained',
    'portfolio.caseThree.copyPrefix': 'Personalized journeys raised NPS to',
    'portfolio.caseThree.impact': '68',
    'portfolio.caseThree.copySuffix': '.',
    'testimonials.heading': 'Partnerships that inspire.',
    'testimonials.lead': 'Feedback from brands setting new standards with us.',
    'testimonials.first.quote': '“Onkel Tom enabled our team to make data-driven calls in record time.”',
    'testimonials.first.name': 'Elena Gruber',
    'testimonials.first.role': 'CMO, FlowPay',
    'testimonials.second.quote': '“From idea to reporting we felt guided and informed at all times.”',
    'testimonials.second.name': 'Malik Aydin',
    'testimonials.second.role': 'Head of Growth, UrbanYard',
    'testimonials.third.quote': '“We rarely experience communication that is so clear and empathetic.”',
    'testimonials.third.name': 'Anja Keller',
    'testimonials.third.role': 'Director of Communications, HealthFirst',
    'faq.heading': 'Answers to frequent questions.',
    'faq.lead': 'Transparency matters to us. Find concise answers here.',
    'faq.one.question': 'How fast can we start?',
    'faq.one.answer': 'After the kick-off we launch first measures within ten business days.',
    'faq.two.question': 'Which industries do you serve?',
    'faq.two.answer': 'We collaborate with technology, retail, healthcare, and education brands.',
    'faq.three.question': 'What do your fees look like?',
    'faq.three.answer': 'We design modular retainers from €4,500 per month tailored to your goals.',
    'contact.heading': "Let's talk.",
    'contact.lead': 'Tell us about your growth goals – we reply within one business day.',
    'contact.form.nameLabel': 'Name',
    'contact.form.namePlaceholder': 'First and last name',
    'contact.form.emailLabel': 'Email',
    'contact.form.emailPlaceholder': 'name@company.com',
    'contact.form.companyLabel': 'Company',
    'contact.form.companyPlaceholder': 'Company name',
    'contact.form.messageLabel': 'Project brief',
    'contact.form.messagePlaceholder': 'What goals are you pursuing?',
    'contact.form.privacy': 'I agree to the processing of my data according to the privacy notice.',
    'contact.form.submit': 'Send message',
    'contact.form.statusIdle': 'We reply within one business day.',
    'contact.form.statusSending': 'Reviewing your request…',
    'contact.form.statusSuccess': 'Thank you! We will reach out shortly.',
    'contact.form.statusError': 'Something went wrong. Please try again.',
    'contact.form.toastSuccess': 'Request submitted successfully.',
    'contact.form.toastError': 'Message could not be sent. Please use the email fallback.',
    'contact.form.mailtoSubject': 'Project inquiry via onkeltom.de',
    'footer.copyPrefix': '©',
    'footer.year': '2024-01-01',
    'footer.copySuffix': 'Onkel Tom Digital Agency. All rights reserved.',
    'footer.mail': 'hallo@onkeltom.de',
    'footer.privacy': 'Privacy',
  },
};

const supportedLocales = Object.keys(translations);
const storageKey = 'preferredLocale';
let currentLocale = 'de';
let toastTimeout;

const getStoredLocale = () => {
  try {
    const stored = window.localStorage.getItem(storageKey);
    if (stored && supportedLocales.includes(stored)) {
      return stored;
    }
  } catch (error) {
    console.warn('Locale storage unavailable', error);
  }
  return null;
};

const detectBrowserLocale = () => {
  const navigatorLocale = (navigator.language || navigator.languages?.[0] || 'de').slice(0, 2).toLowerCase();
  return supportedLocales.includes(navigatorLocale) ? navigatorLocale : 'de';
};

const formatWithIntl = (locale, type, value, options) => {
  if (!value) {
    return '';
  }
  const parsedOptions = options ? JSON.parse(options) : undefined;

  switch (type) {
    case 'currency':
    case 'number': {
      const numericValue = Number(value);
      if (Number.isNaN(numericValue)) {
        return value;
      }
      return new Intl.NumberFormat(locale, parsedOptions).format(numericValue);
    }
    case 'percent': {
      const numericValue = Number(value);
      if (Number.isNaN(numericValue)) {
        return value;
      }
      return new Intl.NumberFormat(locale, parsedOptions || { style: 'percent', maximumFractionDigits: 0 }).format(numericValue);
    }
    case 'date': {
      const dateValue = new Date(value);
      if (Number.isNaN(dateValue.getTime())) {
        return value;
      }
      return new Intl.DateTimeFormat(locale, parsedOptions || { year: 'numeric', month: '2-digit', day: '2-digit' }).format(dateValue);
    }
    default:
      return value;
  }
};

const updatePlaceholders = (locale) => {
  document.querySelectorAll('[data-i18n-placeholder]').forEach((element) => {
    const { i18nPlaceholder } = element.dataset;
    if (!i18nPlaceholder) {
      return;
    }
    const translation = translations[locale][i18nPlaceholder];
    if (translation) {
      element.setAttribute('placeholder', translation);
    }
  });
};

const translateElement = (element, locale) => {
  const { i18n: key, format: formatType, formatValue, formatOptions } = element.dataset;
  if (!key) {
    return;
  }
  const translation = translations[locale][key];
  if (formatType) {
    const formatted = formatWithIntl(locale, formatType, formatValue || translation, formatOptions);
    if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {
      element.value = formatted;
    } else {
      element.textContent = formatted;
    }
    return;
  }

  if (!translation) {
    return;
  }

  if (element.tagName === 'META') {
    element.setAttribute('content', translation);
  } else if (element instanceof HTMLInputElement || element instanceof HTMLTextAreaElement) {
    element.value = translation;
  } else if (element instanceof HTMLTitleElement) {
    element.textContent = translation;
    document.title = translation;
  } else {
    element.textContent = translation;
  }
};

const applyTranslations = (locale) => {
  const dictionary = translations[locale];
  if (!dictionary) {
    return;
  }
  document.documentElement.lang = locale;
  document.querySelectorAll('[data-i18n]').forEach((element) => translateElement(element, locale));
  updatePlaceholders(locale);
};

const persistLocale = (locale) => {
  try {
    window.localStorage.setItem(storageKey, locale);
  } catch (error) {
    console.warn('Locale storage unavailable', error);
  }
};

const toggleLocale = () => {
  const nextLocale = currentLocale === 'de' ? 'en' : 'de';
  setLocale(nextLocale);
};

const showToast = (message, variant = 'info') => {
  const toast = document.getElementById('toast');
  if (!toast) {
    return;
  }
  const baseClasses = 'pointer-events-auto inline-flex items-center rounded-full px-5 py-2 text-sm font-semibold shadow-soft ring-1 ring-slate-900/10';
  const variantClasses = {
    success: 'bg-emerald-500 text-white',
    error: 'bg-rose-500 text-white',
    info: 'bg-slate-900 text-white',
  };
  toast.innerHTML = `<span class="${baseClasses} ${variantClasses[variant] || variantClasses.info}">${message}</span>`;
  toast.classList.remove('opacity-0');
  clearTimeout(toastTimeout);
  toastTimeout = window.setTimeout(() => {
    toast.classList.add('opacity-0');
  }, 3200);
};

const scrollToTarget = (targetId) => {
  const target = document.getElementById(targetId);
  if (!target) {
    return;
  }
  target.scrollIntoView({ behavior: 'smooth', block: 'start' });
};

const createMailtoFallback = (formData) => {
  const dictionary = translations[currentLocale];
  const email = dictionary['footer.mail'] || 'hallo@onkeltom.de';
  const subject = encodeURIComponent(dictionary['contact.form.mailtoSubject'] || 'Projektanfrage über onkeltom.de');
  const nameLabel = dictionary['contact.form.nameLabel'] || 'Name';
  const emailLabel = dictionary['contact.form.emailLabel'] || 'E-Mail';
  const companyLabel = dictionary['contact.form.companyLabel'] || 'Unternehmen';
  const messageLabel = dictionary['contact.form.messageLabel'] || 'Projektbeschreibung';
  const bodyLines = [
    `${nameLabel}: ${formData.get('name') || ''}`,
    `${emailLabel}: ${formData.get('email') || ''}`,
    `${companyLabel}: ${formData.get('company') || ''}`,
    `${messageLabel}:`,
    '',
    formData.get('message') || '',
  ];
  const body = encodeURIComponent(bodyLines.join('\n'));
  return `mailto:${email}?subject=${subject}&body=${body}`;
};

const setStatusMessage = (statusElement, locale, key) => {
  if (!statusElement) {
    return;
  }
  statusElement.dataset.statusKey = key;
  const message = translations[locale][key];
  if (message) {
    statusElement.textContent = message;
  }
};

const handleFormSubmission = () => {
  const form = document.getElementById('contactForm');
  const statusElement = document.getElementById('formStatus');
  if (!form || !statusElement) {
    return;
  }

  const submitButton = form.querySelector('[type="submit"]');

  form.addEventListener('submit', async (event) => {
    event.preventDefault();
    const formData = new FormData(form);
    setStatusMessage(statusElement, currentLocale, 'contact.form.statusSending');
    if (submitButton instanceof HTMLButtonElement) {
      submitButton.disabled = true;
      submitButton.classList.add('opacity-70');
    }

    const endpoint = form.getAttribute('action');
    const payload = Object.fromEntries(formData.entries());

    try {
      const response = await fetch(endpoint || '', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          Accept: 'application/json',
        },
        body: JSON.stringify(payload),
      });

      if (!response.ok) {
        throw new Error('Form submission failed');
      }

      setStatusMessage(statusElement, currentLocale, 'contact.form.statusSuccess');
      showToast(translations[currentLocale]['contact.form.toastSuccess'], 'success');
      form.reset();
    } catch (error) {
      console.error('Form submission error', error);
      setStatusMessage(statusElement, currentLocale, 'contact.form.statusError');
      showToast(translations[currentLocale]['contact.form.toastError'], 'error');
      window.location.href = createMailtoFallback(formData);
    } finally {
      if (submitButton instanceof HTMLButtonElement) {
        submitButton.disabled = false;
        submitButton.classList.remove('opacity-70');
      }
    }
  });
};

const bindInteractions = () => {
  const heroCta = document.getElementById('heroCta');
  const portfolioCta = document.getElementById('portfolioCta');
  const heroVideo = document.getElementById('heroVideo');

  heroCta?.addEventListener('click', () => scrollToTarget('contact'));
  portfolioCta?.addEventListener('click', () => scrollToTarget('contact'));
  heroVideo?.addEventListener('click', (event) => {
    event.preventDefault();
    const videoUrl = heroVideo.dataset.videoTarget || heroVideo.getAttribute('href');
    if (videoUrl) {
      window.open(videoUrl, '_blank', 'noopener');
    }
  });
};

const initializeLocaleToggle = () => {
  const toggleButton = document.getElementById('localeToggle');
  if (!toggleButton) {
    return;
  }
  toggleButton.addEventListener('click', toggleLocale);
};

const updateStatusForLocale = () => {
  const statusElement = document.getElementById('formStatus');
  if (!statusElement) {
    return;
  }
  const { statusKey = 'contact.form.statusIdle' } = statusElement.dataset;
  setStatusMessage(statusElement, currentLocale, statusKey);
};

const setLocale = (locale) => {
  currentLocale = supportedLocales.includes(locale) ? locale : 'de';
  applyTranslations(currentLocale);
  updateStatusForLocale();
  persistLocale(currentLocale);
};

const init = () => {
  const storedLocale = getStoredLocale();
  currentLocale = storedLocale || detectBrowserLocale();
  applyTranslations(currentLocale);
  updateStatusForLocale();
  initializeLocaleToggle();
  bindInteractions();
  handleFormSubmission();
};

window.addEventListener('DOMContentLoaded', () => {
  init();
});

window.addEventListener('storage', (event) => {
  if (event.key === storageKey && event.newValue && supportedLocales.includes(event.newValue)) {
    setLocale(event.newValue);
  }
});

export {};
